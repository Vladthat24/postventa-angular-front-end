<div class="h-full flex flex-col relative">
  <ngx-spinner
    [fullScreen]="false"
    bdColor="rgba(70, 84, 153,8.3)"
    size="medium"
    name="modal-table"
    color="#7884E3"
  ></ngx-spinner>
  <div [class.overflow-auto]="dataSource.filteredData.length" class="h-full">
    <table
      [@scaleFadeIn]="dataSource.filteredData"
      [dataSource]="dataSource"
      [matSortActive]="sortBy"
      [matSortDirection]="sortDir"
      class="w-full"
      mat-table
      matSort
      matSortDisableClear
    >
      <ng-container *ngFor="let column of columns">
        <ng-container
          *ngIf="column.type === 'image'"
          [matColumnDef]="column.property"
          [sticky]="column.sticky"
        >
          <th
            *matHeaderCellDef
            [mat-sort-header]="column.sortProperty"
            [disabled]="!column.sort"
            [ngClass]="column.cssLabel"
            mat-header-cell
          >
            {{ column.label }}
          </th>
          <td *matCellDef="let row" mat-cell>
            <img
              [src]="row[column.property]"
              class="avatar h-9 w-9 align-middle my-2"
            />
          </td>
        </ng-container>

        <ng-container
          *ngIf="column.type === 'currency'"
          [matColumnDef]="column.property"
          [sticky]="column.sticky"
        >
          <th
            *matHeaderCellDef
            [mat-sort-header]="column.sortProperty"
            [disabled]="!column.sort"
            [ngClass]="column.cssLabel"
            mat-header-cell
          >
            {{ column.label }}
          </th>
          <td
            *matCellDef="let row"
            [ngClass]="column.cssProperty"
            mat-cell
          >
            {{ row[column.property] | currency : "" : "" }}
          </td>
        </ng-container>

        <ng-container
          *ngIf="column.type === 'number'"
          [matColumnDef]="column.property"
          [sticky]="column.sticky"
        >
          <th
            *matHeaderCellDef
            [mat-sort-header]="column.sortProperty"
            [disabled]="!column.sort"
            [ngClass]="column.cssLabel"
            mat-header-cell
          >
            {{ column.label }}
          </th>
          <td
            *matCellDef="let row"
            [ngClass]="column.cssProperty"
            mat-cell
          >
            {{ row[column.property] }}
          </td>
        </ng-container>

        <ng-container
          *ngIf="column.type === 'text'"
          [matColumnDef]="column.property"
          [sticky]="column.sticky"
        >
          <th
            *matHeaderCellDef
            [mat-sort-header]="column.sortProperty"
            [disabled]="!column.sort"
            [ngClass]="column.cssLabel"
            mat-header-cell
          >
            {{ column.label }}
          </th>
          <td *matCellDef="let row" mat-cell>
            <div>
              <div *ngIf="!row[column.subProperty]">
                <p [ngClass]="column.cssProperty">
                  {{ row[column.property] | titlecase }}
                </p>
              </div>
              <div *ngIf="row[column.subProperty]">
                <p [ngClass]="column.cssProperty">
                  {{ row[column.property] | titlecase }}
                </p>
                <p [ngClass]="column.cssProperty">
                  {{ row[column.subProperty] | titlecase }}
                </p>
              </div>
            </div>
          </td>
        </ng-container>

        <ng-container
          *ngIf="column.type === 'textUppercase'"
          [matColumnDef]="column.property"
          [sticky]="column.sticky"
        >
          <th
            *matHeaderCellDef
            [mat-sort-header]="column.sortProperty"
            [disabled]="!column.sort"
            [ngClass]="column.cssLabel"
            mat-header-cell
          >
            {{ column.label }}
          </th>
          <td *matCellDef="let row" mat-cell>
            <div>
              <div *ngIf="!row[column.subProperty]">
                <p [ngClass]="column.cssProperty">
                  {{ row[column.property] | uppercase }}
                </p>
              </div>
              <div *ngIf="row[column.subProperty]">
                <p [ngClass]="column.cssProperty">
                  {{ row[column.property] | uppercase }}
                </p>
                <p [ngClass]="column.cssProperty">
                  {{ row[column.subProperty] | uppercase }}
                </p>
              </div>
            </div>
          </td>
        </ng-container>

        <ng-container
          *ngIf="column.type === 'datetime'"
          [matColumnDef]="column.property"
        >
          <th
            *matHeaderCellDef
            [mat-sort-header]="column.sortProperty"
            [disabled]="!column.sort"
            [ngClass]="column.cssLabel"
            mat-header-cell
          >
            {{ column.label }}
          </th>

          <td *matCellDef="let row" [ngClass]="column.cssProperty" mat-cell>
            {{ row[column.property] | date : "dd-MM-yyyy hh:mm:ss a" }}
          </td>
        </ng-container>

        <ng-container
          *ngIf="column.type === 'badge'"
          [matColumnDef]="column.property"
        >
          <th
            *matHeaderCellDef
            [mat-sort-header]="column.sortProperty"
            [disabled]="!column.sort"
            [ngClass]="column.cssLabel"
            mat-header-cell
          >
            {{ column.label }}
          </th>
          <td *matCellDef="let row" [ngClass]="column.cssProperty" mat-cell>
            <ng-container>
              <div
                [ngClass]="row['badgeColor']"
                class="rounded px-2 py-1 font-medium text-xs inline-block"
              >
                {{ row[column.property] | uppercase }}
              </div>
            </ng-container>
          </td>
        </ng-container>

        <ng-container
          *ngIf="column.type === 'icon'"
          [matColumnDef]="column.property"
        >
          <th *matHeaderCellDef [ngClass]="column.cssLabel" mat-header-cell>
            {{ column.label }}
          </th>
          <td *matCellDef="let row" [ngClass]="column.cssProperty" mat-cell>
            <div
              *ngIf="row[column.property].icon"
              [ngClass]="row[column.property].css"
              [class]="column.action ? 'cursos-pointer' : ''"
              (click)="
                column.action
                  ? rowClick.emit({
                      action: column.action,
                      row: row
                    })
                  : ''
              "
            >
              <mat-icon
                [matTooltip]="row[column.property].tooltip"
                [icIcon]="row[column.property].icon"
                matTooltipPosition="above"
              >
              </mat-icon>
            </div>
          </td>
        </ng-container>
      </ng-container>

      <tbody>
        <tr
          *matHeaderRowDef="visibleColumns; sticky: true"
          mat-header-row
          class="h-18"
        ></tr>
        <tr
          *matRowDef="let row; let i = index; columns: visibleColumns"
          mat-row
          @fadeInUp
          class="h-16"
        ></tr>
      </tbody>
    </table>
    <div
      *ngIf="dataSource.filteredData.length === 0"
      class="flex h-full flex-col justify-center items-center"
    >
      <img
        @scaleFadeIn
        class="m-12 h-64"
        src="../../../../assets/img/illustrations/idea.svg"
      />
      <h2 class="headline m-0 text-center">
        No hay resultados en esta b√∫squeda
      </h2>
    </div>
  </div>
  <div
    class="h-24 flex gap-4 justify-between items-center flex-grap mx-10 my-2"
  >
    <div *ngIf="dataSource.filteredData.length !== 0" class="flex gap-3">
      <ng-container></ng-container>
    </div>

    <mat-paginator
      [class.hidden]="!dataSource.filteredData.length"
      [pageSizeOptions]="paginatorOptions.pageSizeOptions"
      [pageSize]="paginatorOptions.pageSize"
      [length]="paginatorOptions.pageLength"
      [showFirstLastButtons]="true"
    >
    </mat-paginator>
  </div>
</div>
